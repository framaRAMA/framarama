{% extends "config/base.display.html" %}

{% block content_display %}
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3">
  {% set stats = display.get_latest_status(60) %}
  {% set latest = display.get_latest_items(10)|list %}

  <div class="col">
    <div class="card mt-2">
      <div class="card-body">
        {{ lib.display_info(display, stats|first if stats else null) }}
      </div>
    </div>
  </div>

  <div class="col">
    <div class="card mt-2">
      <div class="card-body text-center">
        {{ lib.display_chart_cpu(stats) }}
      </div>
    </div>
  </div>

  <div class="col">
    <div class="card mt-2">
      <div class="card-body text-center">
        <h6 class="card-subtitle mb-2 text-muted">
          Latest items
        </h6>
        <div id="carouselPictures" class="carousel slide mt-2 w-75 h-75" data-bs-ride="carousel">
          <div class="carousel-indicators">
            {% for item in latest %}
              <button type="button" data-bs-target="#carouselPictures" data-bs-slide-to="{{ loop.index0 }}" class="{% if loop.index0 == 0 %}active{% endif %}" aria-current="true" aria-label="Slide {{ loop.index + 1 }}"></button>
            {% endfor %}
          </div>
          <div class="carousel-inner bg-light rounded rounded-5">
            {% for item in latest %}
              <div class="carousel-item {% if loop.index0 == 0 %}active{% endif %} bg-light">
                <img src="data:{{ item.thumbnail.data_mime }};base64,{{ item.thumbnail.data()|b64encode }}" item="{{ loop.index0 }}" class="d-block w-100 h-100 rounded rounded-5" loading="lazy"/>
              </div>
            {% endfor %}
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselPictures" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselPictures" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="col">
    <div class="card mt-2">
      <div class="card-body text-center">
        <h6 class="card-subtitle mb-2 text-muted">
          Latest items
        </h6>
        {% set latest_items = [] %}
        {% for item in display.get_latest_items(10)|list %}
          {% set tmp = latest_items.append({
            'date': item.date_last_seen|date_format('%Y-%m-%d %H:%m:%S'),
            'url': ('<a href="' + item.item.url + '" target="_blank">' + item.item.url + '</a>')|safe,
            'count': item.count_hit,
          }) %}
        {% endfor %}
        {{ lib.list_table(latest_items, {'date': 'Date', 'url': 'URL', 'count': 'Views' }) }}
      </div>
    </div>
  </div>


  <div class="col">
    <div class="card mt-2">
      <div class="card-body text-center">
        <h6 class="card-subtitle mb-2 text-muted">
          Top items
        </h6>
        {% set latest_items = [] %}
        {% for item in display.get_top_items(10)|list %}
          {% set tmp = latest_items.append({
            'date': item.date_last_seen|date_format('%Y-%m-%d %H:%m:%S'),
            'url': ('<a href="' + item.item.url + '" target="_blank">' + item.item.url + '</a>')|safe,
            'count': item.count_hit,
          }) %}
        {% endfor %}
        {{ lib.list_table(latest_items, {'date': 'Date', 'url': 'URL', 'count': 'Views' }) }}
      </div>
    </div>
  </div>

</div>

{% endblock %}

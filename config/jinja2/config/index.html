{% extends "config/base.html" %}

{% block content %}
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3">
  {% set display = displays[0] if displays|length else null %}
  {% set status = display.get_latest_status() if display else null %}
  {% set items = display.items if display else null %}

  {% if 'frames_chart' in dashboards %}
    <div class="col">
      <div class="card mt-2">
        <div class="card-body text-center">
          <h6 class="card-subtitle mb-2 text-muted">
            Frames {% if frames|length %}({{ frames|length }}){% endif %}
          </h6>
          {% if frames|length %}
            {% set frames_enabled = frames|selectattr("enabled", "true")|list|length %}
            {% set frames_disabled = frames|selectattr("enabled", "false")|list|length %}
            {{ lib.chart_doughnut('frames-chart', [
              'Enabled (%d)'|format(frames_enabled),
              'Disabled (%d)'|format(frames_disabled)
            ],  [frames_enabled, frames_disabled]) }}
            <a href="{{ url('frame_list') }}" class="btn btn-primary btn-xs">List</a>
          {% else %}
            Create a new frame and associate some media files to it.<br/>
            <a href="{{ url('frame_create') }}" class="btn btn-primary btn-xs m-5">Add</a>
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}

  {% if 'displays_chart' in dashboards %}
    <div class="col">
      <div class="card mt-2">
        <div class="card-body text-center">
          <h6 class="card-subtitle mb-2 text-muted">
            Displays {% if displays|length %}({{ displays|length }}){% endif %}
          </h6>
          {% if displays|length %}
            {% set displays_enabled = displays|selectattr("enabled", "true")|list|length %}
            {% set displays_disabled = displays|selectattr("enabled", "false")|list|length %}
            {{ lib.chart_doughnut('displays-chart', [
              'Enabled (%d)'|format(displays_enabled),
              'Disabled (%d)'|format(displays_disabled)
            ],  [displays_enabled, displays_disabled]) }}
            <a href="{{ url('display_list') }}" class="btn btn-primary btn-xs">List</a>
          {% else %}
            To be able to show the media files of a frame create a display
            and assign a frame to it.<br/>
            <a href="{{ url('display_create') }}" class="btn btn-primary btn-xs m-5">Add</a>
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}

  {% if 'display_info' in dashboards %}
    <div class="col">
      <div class="card mt-2">
        <div class="card-header bg-info text-white">{{ lib.icon('display') }} Display</div>
        {% if display %}
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Runtime information</h6>
            <ul class="card-text">
              <li><strong>{{ display.name }}</strong> frame providing data</li>
              <li>
                on <strong>{{ 'a %dx%d'|format(display.device_width, display.device_height) if display.device_width and display.device_height else 'an unknown' }}</strong> pixel frame</li>
              <li>with <strong>{{ display.frame.items|length }} </strong> pictures in collection</li>
              <li><strong>{{ status if status else '0' }}</strong> pictures served</li>
              <li><strong>{{ display.time_change if display.time_change else 'default'}}</strong> minutes rotation</li>
              <li>Display is <strong>{{ '%s'|format('on' if status.screen_on else 'off') if status else 'off'}}</strong></li>
            </ul>
            <div class="text-center">
              <a href="{{ url('display_info', args=[display.id]) }}" class="btn btn-primary btn-xs">Open</a>
            </div>
          </div>
        {% else %}
          <div class="card-body text-center">
            To be able to show some details about the display create a new one.<br/>
            <a href="{{ url('display_create') }}" class="btn btn-primary btn-xs m-5">Add</a>
          </div>
        {% endif %}
      </div>
    </div>
  {% endif %}

  <div class="col">
    <div class="card mt-2">
      <div class="card-header">{{ lib.icon('frame') }} Pictures</div>
      <div class="card-body">
        <h6 class="card-subtitle mb-2 text-muted">Current and latest picture shown</h6>
        {% if display.items|length %}
          <p class="card-text">
            <div id="carouselPictures" class="carousel slide" data-bs-ride="carousel">
              <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselPictures" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#carouselPictures" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#carouselPictures" data-bs-slide-to="2" aria-label="Slide 3"></button>
                <button type="button" data-bs-target="#carouselPictures" data-bs-slide-to="3" aria-label="Slide 4"></button>
                <button type="button" data-bs-target="#carouselPictures" data-bs-slide-to="4" aria-label="Slide 5"></button>
              </div>
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img src="http://digiframe.home/digiframe/index.php?cmd=picture&picture=1&dl=th" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                  <img src="http://digiframe.home/digiframe/index.php?cmd=picture&picture=2&dl=th" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                  <img src="http://digiframe.home/digiframe/index.php?cmd=picture&picture=3&dl=th" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                  <img src="http://digiframe.home/digiframe/index.php?cmd=picture&picture=4&dl=th" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                  <img src="http://digiframe.home/digiframe/index.php?cmd=picture&picture=5&dl=th" class="d-block w-100" alt="...">
                </div>
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselPictures" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselPictures" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          </p>
        {% else %}
          <div class="card-body text-center">
            Currently no pictures shown on this display. There's no frame assigned to this
            display or the frame does not have items currently.<br/>
          </div>
          <div class="text-center">
            <a href="{{ url('frame_create') }}" class="btn btn-primary btn-xs">Create frame</a>
            <a href="{{ url('display_edit', args=[display.id]) }}" class="btn btn-primary btn-xs">Assign frame</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  {% if 'system_info' in dashboards %}
    <div class="col">
      <div class="card mt-2">
        <div class="card-header bg-info text-white">{{ lib.icon('system') }} System</div>
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">Runtime information</h6>
          <ul class="card-text">
            <li><strong>{{ '%d'|format(system.uptime / 60 / 60 / 24) }}</strong> days running</li>
            <li><strong>{{ '%.2f'|format(system.cpu.load) }}</strong> load, <strong>{{ '%.1f'|format(system.cpu.temp) }}Â°C</strong> CPU</li>
            <li>
              <strong>{{ '%d'|format(system.disk.data.used * 100 / (system.disk.data.used + system.disk.data.free)) }}%</strong> disk usage,
              <strong>{{ lib.format_bytes(system.disk.data.used) }}</strong>/{{ lib.format_bytes(system.disk.data.used + system.disk.data.free, true) }}
            </li>
            <li>
              <strong>{{ '%d'|format(system.memory.used * 100 / (system.memory.used + system.memory.free)) }}%</strong> memory usage,
              <strong>{{ lib.format_bytes(system.memory.used) }}</strong>/{{ lib.format_bytes(system.memory.used + system.memory.free, true) }}
            </li>
          </ul>
        </div>
      </div>
    </div>
  {% endif %}

  {% if 'software_info' in dashboards %}
    <div class="col">
      <div class="card mt-2">
        <div class="card-header">{{ lib.icon('info') }} Status</div>
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">System information</h6>
          <ul class="card-text">
            <li>Software Version: {{ system.app.revision }} ({{ system.app.date }})</li>
            <li>Environment: <strong>{% if config %}{{ config.mode }}{% else %}cloud{% endif %}</strong> setup</li>
          </ul>
        </div>
      </div>
    </div>
  {% endif %}

</div>
{% endblock %}
